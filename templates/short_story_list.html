{% extends 'base.html' %}
{% block title %}Short Stories{% endblock %}

{% block content %}
<div class="container">
    <!-- Enhanced Header -->
    <div style="text-align: center; margin-bottom: 4em; position: relative;">
        <h1 style="font-size: 4em; margin-bottom: 1em; background: linear-gradient(135deg, #c287a3, #b4316a, #a52a5c); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">
            Short Stories Collection
        </h1>
        <p style="font-size: 1.5em; color: var(--text-primary); max-width: 800px; margin: 0 auto; line-height: 1.8; font-weight: 600;">
            Discover complete tales and standalone stories, each a perfect world captured in words
        </p>
        <div style="width: 300px; height: 6px; background: var(--gradient-primary); margin: 1.5em auto; border-radius: 3px; box-shadow: 0 4px 15px rgba(252, 228, 236, 0.5);"></div>
    </div>

    <!-- Category Menu -->
    {% if categories %}
    <div class="category-menu" style="text-align: center; margin-bottom: 2em;">
        <div class="category-toggle-btn" onclick="toggleCategoryMenu()" style="
            background: linear-gradient(135deg, #c287a3, #b4316a); 
            color: white; 
            border: none; 
            border-radius: 50px; 
            padding: 1rem 1.5rem; 
            cursor: pointer; 
            box-shadow: 0 8px 25px rgba(194, 135, 163, 0.4); 
            font-weight: 700; 
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            user-select: none;">
            <span style="font-size: 1.2em;">üìö</span>
            <span>Browse Categories</span>
            <span class="menu-arrow" style="font-size: 0.8em; transition: transform 0.3s ease;">‚ñº</span>
        </div>
        
        <div class="category-dropdown" style="
            position: relative; 
            top: 15px; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 40px rgba(194, 135, 163, 0.3); 
            border: 2px solid var(--accent-gold);
            min-width: 280px;
            max-width: 400px;
            max-height: 400px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
            margin: 0 auto;">
            
            <div style="padding: 1rem; border-bottom: 1px solid var(--accent-gold);">
                <div style="font-weight: 700; color: var(--text-primary); font-size: 0.9rem; text-align: center;">
                    ‚ú® Browse by Category
                </div>
            </div>
            
            <div style="padding: 0.5rem;">
                <!-- All Short Stories Option -->
                <a href="?" class="category-dropdown-item" style="
                    display: flex; 
                    align-items: center; 
                    gap: 0.8rem; 
                    padding: 0.8rem 1rem; 
                    text-decoration: none; 
                    color: var(--text-primary); 
                    border-radius: 15px; 
                    transition: all 0.3s ease;
                    background: {% if not selected_category %}linear-gradient(135deg, #c287a3, #b4316a); color: white;{% else %}transparent;{% endif %}
                    margin-bottom: 0.3rem;">
                    <span style="font-size: 1.1em;">üè†</span>
                    <span style="font-weight: 600; font-size: 0.9rem;">All Short Stories</span>
                </a>
                
                <!-- Category Options -->
                {% for category in categories %}
                <a href="?category={{ category.id }}" class="category-dropdown-item" style="
                    display: flex; 
                    align-items: center; 
                    gap: 0.8rem; 
                    padding: 0.8rem 1rem; 
                    text-decoration: none; 
                    color: var(--text-primary); 
                    border-radius: 15px; 
                    transition: all 0.3s ease;
                    background: {% if selected_category == category.id %}linear-gradient(135deg, #c287a3, #b4316a); color: white;{% else %}transparent;{% endif %}
                    margin-bottom: 0.3rem;">
                    {% if category.icon %}
                        <span style="font-size: 1.1em;">{{ category.icon }}</span>
                    {% else %}
                        <span style="font-size: 1.1em;">üìö</span>
                    {% endif %}
                    <span style="font-weight: 600; font-size: 0.9rem;">{{ category.name }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Beautiful Short Stories Grid -->
    {% if short_stories %}
    <div class="enhanced-story-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 2.5em; padding: 3em 0; max-width: 1400px; margin: 0 auto;">
        {% for story in short_stories %}
        <div class="enhanced-story-card" data-index="{{ forloop.counter0 }}" style="
            background: linear-gradient(145deg, #ffffff 0%, #fefcfd 50%, #f9f5f7 100%);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(194, 135, 163, 0.15), 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            border: 2px solid transparent;
            opacity: 0;
            transform: translateY(60px) scale(0.8);
            animation: cardEntrance 0.8s cubic-bezier(0.23, 1, 0.320, 1) forwards;
            animation-delay: calc({{ forloop.counter0 }} * 0.15s);
            ">
            
            <!-- Card Border Gradient -->
            <div style="position: absolute; inset: 0; padding: 2px; background: linear-gradient(135deg, var(--accent-gold), #e8d1dc, var(--accent-gold)); border-radius: 25px; z-index: -1;">
                <div style="width: 100%; height: 100%; background: linear-gradient(145deg, #ffffff 0%, #fefcfd 50%, #f9f5f7 100%); border-radius: 23px;"></div>
            </div>

            <!-- Enhanced Cover Image Section -->
            {% if story.cover_image %}
            <div class="cover-image-container" style="position: relative; width: 100%; height: 280px; overflow: hidden; margin-bottom: 0;">
                <img src="{{ story.cover_image.url }}" alt="{{ story.title_en }} cover" 
                     class="story-cover-image"
                     style="width: 100%; height: 100%; object-fit: cover; transition: all 0.8s cubic-bezier(0.23, 1, 0.320, 1); filter: brightness(0.95);">
                
                <!-- Gradient Overlay -->
                <div class="gradient-overlay" style="position: absolute; inset: 0; background: linear-gradient(135deg, transparent 0%, rgba(194, 135, 163, 0.1) 50%, rgba(180, 49, 106, 0.2) 100%); opacity: 0; transition: all 0.6s ease;"></div>
                
                <!-- Complete Story Badge -->
                <div class="complete-badge" style="position: absolute; top: 15px; right: 15px; 
                            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6)); 
                            backdrop-filter: blur(10px);
                            color: #ffffff; 
                            padding: 0.6em 1.2em; 
                            border-radius: 20px; 
                            font-size: 0.9em; 
                            font-weight: 700;
                            border: 1px solid rgba(255,255,255,0.2);
                            transform: translateY(-5px);
                            opacity: 0.9;
                            transition: all 0.4s ease;">
                    üìñ Complete Story
                </div>
            </div>
            {% else %}
            <div style="width: 100%; height: 280px; 
                        background: linear-gradient(135deg, var(--accent-gold) 0%, #e8d1dc 50%, #c287a3 100%); 
                        margin-bottom: 0; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        font-size: 4em; 
                        color: rgba(255,255,255,0.9); 
                        position: relative; 
                        overflow: hidden;">
                
                <!-- Animated Background Pattern -->
                <div style="position: absolute; inset: 0; 
                            background-image: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 0%, transparent 50%), 
                                              radial-gradient(circle at 75% 75%, rgba(255,255,255,0.1) 0%, transparent 50%);
                            animation: patternMove 10s linear infinite;"></div>
                
                <!-- Book Icon -->
                <div style="font-size: 4em; z-index: 2;">üìñ</div>
                
                <!-- Complete Story Badge -->
                <div class="complete-badge" style="position: absolute; top: 15px; right: 15px; 
                            background: rgba(255,255,255,0.2); 
                            backdrop-filter: blur(10px);
                            color: #ffffff; 
                            padding: 0.6em 1.2em; 
                            border-radius: 20px; 
                            font-size: 0.9em; 
                            font-weight: 700;
                            border: 1px solid rgba(255,255,255,0.3);">
                    üìñ Complete Story
                </div>
            </div>
            {% endif %}
            
            <!-- Enhanced Story Content -->
            <div style="padding: 2em; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <!-- Story Title -->
                <h2 class="faruma" style="font-size: 1.9em; 
                                           margin-bottom: 1.2em; 
                                           background: linear-gradient(135deg, #c287a3, #b4316a, #a52a5c); 
                                           background-clip: text; 
                                           -webkit-background-clip: text; 
                                           -webkit-text-fill-color: transparent; 
                                           font-weight: 800; 
                                           line-height: 1.3;
                                           text-align: center;
                                           width: 100%;
                                           direction: rtl !important;
                                           font-family: 'Faruma', 'Noto Sans Dhivehi', Arial, serif !important;">
                    {{ story.title_dv }}
                </h2>
                
                <!-- Perfect Story Metadata -->
                <div class="metadata-container" style="margin-bottom: 1.5em; display: flex; flex-wrap: wrap; gap: 0.4em; justify-content: center; align-items: center;">
                    {% if story.author %}
                    <span class="metadata-badge author" style="background: linear-gradient(135deg, #059669, #b4316a); 
                                 padding: 0.4rem 0.8rem; 
                                 border-radius: 15px; 
                                 border: 2px solid #059669; 
                                 font-size: 0.8rem; 
                                 color: #ffffff; 
                                 font-weight: 600;
                                 box-shadow: 0 2px 6px rgba(5, 150, 105, 0.3);
                                 transition: all 0.3s ease;
                                 display: inline-flex;
                                 align-items: center;
                                 gap: 0.3rem;
                                 position: relative;
                                 overflow: hidden;"
                          onmouseover="this.style.transform='translateY(-1px) scale(1.03)'; this.style.boxShadow='0 4px 10px rgba(5, 150, 105, 0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 2px 6px rgba(5, 150, 105, 0.3)'">
                        <span style="font-size: 0.9rem;">‚úçÔ∏è</span>
                        <span>{{ story.author.name }}</span>
                        <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%); transition: left 0.6s ease;"></div>
                    </span>
                    {% endif %}
                    {% if story.genre %}
                    <span class="metadata-badge genre" style="background: linear-gradient(135deg, #6b46c1, #b4316a); 
                                 padding: 0.4rem 0.8rem; 
                                 border-radius: 15px; 
                                 border: 2px solid #6b46c1; 
                                 font-size: 0.8rem; 
                                 color: #ffffff; 
                                 font-weight: 600;
                                 box-shadow: 0 2px 6px rgba(107, 70, 193, 0.3);
                                 transition: all 0.3s ease;
                                 display: inline-flex;
                                 align-items: center;
                                 gap: 0.3rem;
                                 position: relative;
                                 overflow: hidden;"
                          onmouseover="this.style.transform='translateY(-1px) scale(1.03)'; this.style.boxShadow='0 4px 10px rgba(107, 70, 193, 0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 2px 6px rgba(107, 70, 193, 0.3)'">
                        {% if story.genre.icon %}
                            <span style="font-size: 0.9rem;">{{ story.genre.icon }}</span>
                        {% else %}
                            <span style="font-size: 0.9rem;">üé≠</span>
                        {% endif %}
                        <span>{{ story.genre.name }}</span>
                        <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%); transition: left 0.6s ease;"></div>
                    </span>
                    {% endif %}
                    {% if story.category %}
                    <span class="metadata-badge category" style="background: linear-gradient(135deg, {{ story.category.color }}, #b4316a); 
                                 padding: 0.4rem 0.8rem; 
                                 border-radius: 15px; 
                                 border: 2px solid {{ story.category.color }}; 
                                 font-size: 0.8rem; 
                                 color: #ffffff; 
                                 font-weight: 600;
                                 box-shadow: 0 2px 6px rgba(194, 135, 163, 0.3);
                                 transition: all 0.3s ease;
                                 display: inline-flex;
                                 align-items: center;
                                 gap: 0.3rem;
                                 position: relative;
                                 overflow: hidden;"
                          onmouseover="this.style.transform='translateY(-1px) scale(1.03)'; this.style.boxShadow='0 4px 10px rgba(194, 135, 163, 0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 2px 6px rgba(194, 135, 163, 0.3)'">
                        {% if story.category.icon %}
                            <span style="font-size: 0.9rem;">{{ story.category.icon }}</span>
                        {% else %}
                            <span style="font-size: 0.9rem;">üè∑Ô∏è</span>
                        {% endif %}
                        <span>{{ story.category.name }}</span>
                        <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%); transition: left 0.6s ease;"></div>
                    </span>
                    {% endif %}
                    <span class="metadata-badge date" style="background: linear-gradient(135deg, #dc2626, #b4316a); 
                                 padding: 0.4rem 0.8rem; 
                                 border-radius: 15px; 
                                 border: 2px solid #dc2626; 
                                 font-size: 0.8rem; 
                                 color: #ffffff; 
                                 font-weight: 600;
                                 box-shadow: 0 2px 6px rgba(220, 38, 38, 0.3);
                                 transition: all 0.3s ease;
                                 display: inline-flex;
                                 align-items: center;
                                 gap: 0.3rem;
                                 position: relative;
                                 overflow: hidden;"
                          onmouseover="this.style.transform='translateY(-1px) scale(1.03)'; this.style.boxShadow='0 4px 10px rgba(220, 38, 38, 0.4)'"
                          onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 2px 6px rgba(220, 38, 38, 0.3)'">
                        <span style="font-size: 0.9rem;">üìÖ</span>
                        <span>{{ story.published_date|date:"M Y" }}</span>
                        <div class="shine-effect" style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%); transition: left 0.6s ease;"></div>
                    </span>
                </div>
                
                <!-- Perfect Action Button -->
                <div style="text-align: center;">
                    <a href="{% url 'short_story_detail' story.pk %}" class="story-scroll-btn">
                        <div class="story-scroll-paper">
                            <div class="story-scroll-content">
                                <span class="story-scroll-icon">üìñ</span>
                                <span class="story-scroll-text">Read Story</span>
                            </div>
                            <div class="story-scroll-ribbon"></div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div style="text-align: center; padding: 6em 3em; background: var(--gradient-tertiary); border-radius: 30px; border: 4px solid var(--accent-gold); margin: 4em 0; position: relative; box-shadow: 0 20px 50px rgba(252, 228, 236, 0.4);">
        <h2 style="font-size: 3em; color: var(--text-primary); margin-bottom: 1.5em; font-weight: 800;">No short stories available currently</h2>
        <p style="font-size: 1.5em; color: var(--text-primary); max-width: 600px; margin: 0 auto; line-height: 1.8; font-weight: 600;">
            We are working hard to add wonderful short stories soon. Follow us for more creativity!
        </p>
        <div style="margin-top: 2em;">
            <a href="/" class="btn" style="display: inline-flex; align-items: center; gap: 12px;">
                Back to Home
            </a>
        </div>
    </div>
    {% endif %}
    
</div>

<style>
/* Use existing styles from story_list.html and adapt */
@keyframes cardEntrance {
    0% { 
        opacity: 0; 
        transform: translateY(60px) scale(0.8) rotateX(15deg);
        filter: blur(5px);
    }
    50% {
        opacity: 0.7;
        transform: translateY(-10px) scale(0.95) rotateX(5deg);
    }
    100% { 
        opacity: 1; 
        transform: translateY(0) scale(1) rotateX(0deg);
        filter: blur(0px);
    }
}

@keyframes patternMove {
    0% { 
        background-position: 0% 0%, 0% 0%; 
    }
    50% { 
        background-position: 100% 100%, -100% -100%; 
    }
    100% { 
        background-position: 0% 0%, 0% 0%; 
    }
}

.enhanced-story-card:hover {
    transform: translateY(-15px) scale(1.02) !important;
    box-shadow: 0 25px 60px rgba(194, 135, 163, 0.25), 
                0 15px 35px rgba(0, 0, 0, 0.15) !important;
}

.enhanced-story-card:hover img {
    transform: scale(1.05) !important;
    filter: brightness(1.1) contrast(1.1) !important;
}

.enhanced-story-card:hover .gradient-overlay {
    opacity: 1 !important;
}

/* Story Scroll Button */
.story-scroll-btn {
    display: inline-block;
    text-decoration: none;
    transition: all 0.4s ease;
    position: relative;
}

.story-scroll-paper {
    position: relative;
    background: var(--gradient-soft);
    padding: 1.2rem 2.8rem 1.2rem 2rem;
    border-radius: 25px 0 0 25px;
    border-right: 6px solid #c287a3;
    box-shadow: 0 2px 6px rgba(252, 228, 236, 0.25);
    transform-style: preserve-3d;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 2px solid var(--accent-gold);
    overflow: hidden;
}

.story-scroll-content {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    position: relative;
    z-index: 2;
}

.story-scroll-icon {
    font-size: 1.2rem;
    transition: all 0.3s ease;
}

.story-scroll-text {
    font-size: 1.1rem;
    font-weight: 700;
    background: linear-gradient(135deg, #b4316a, #a52a5c);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.6);
}

.story-scroll-ribbon {
    position: absolute;
    top: -2px;
    right: -8px;
    bottom: -2px;
    width: 20px;
    background: linear-gradient(135deg, #c287a3, #b4316a, #a52a5c);
    clip-path: polygon(0 0, 80% 0, 100% 50%, 80% 100%, 0 100%);
    box-shadow: 
        0 3px 10px rgba(195, 135, 163, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

.story-scroll-btn:hover .story-scroll-paper {
    transform: translateX(-5px) rotateY(-5deg);
    background: var(--accent-gold);
    box-shadow: 0 4px 12px rgba(248, 187, 217, 0.5);
    border-color: var(--accent-rose);
}

.story-scroll-btn:hover .story-scroll-icon {
    transform: rotate(5deg) scale(1.1);
}

/* Category styles */
.category-toggle-btn:hover {
    transform: scale(1.05) !important;
    box-shadow: 0 12px 30px rgba(194, 135, 163, 0.5) !important;
}

.category-dropdown.active {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) scale(1) !important;
}

.category-dropdown-item:hover {
    background: linear-gradient(135deg, #f8e8f0, #e8d1dc) !important;
    transform: translateX(5px);
}

.menu-arrow.rotated {
    transform: rotate(180deg) !important;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .enhanced-story-grid {
        grid-template-columns: 1fr !important;
        gap: 2em !important;
        padding: 2em 1em !important;
    }
    
    .enhanced-story-card {
        margin: 0 auto;
        max-width: 400px;
    }
}
</style>

<script>
function toggleCategoryMenu() {
    const dropdown = document.querySelector('.category-dropdown');
    const arrow = document.querySelector('.menu-arrow');
    
    dropdown.classList.toggle('active');
    arrow.classList.toggle('rotated');
}

// Close menu when clicking outside
document.addEventListener('click', function(event) {
    const menu = document.querySelector('.category-menu');
    const dropdown = document.querySelector('.category-dropdown');
    const arrow = document.querySelector('.menu-arrow');
    
    if (!menu.contains(event.target)) {
        dropdown.classList.remove('active');
        arrow.classList.remove('rotated');
    }
});

// Enhanced interactions for badges
document.addEventListener('DOMContentLoaded', function() {
    const categoryBadges = document.querySelectorAll('span[onmouseover]');
    
    categoryBadges.forEach(badge => {
        const shineEffect = badge.querySelector('.shine-effect');
        
        badge.addEventListener('mouseenter', function() {
            if (shineEffect) {
                shineEffect.style.left = '100%';
            }
        });
        
        badge.addEventListener('mouseleave', function() {
            if (shineEffect) {
                setTimeout(() => {
                    shineEffect.style.left = '-100%';
                }, 200);
            }
        });
    });
});
</script>

{% endblock %}